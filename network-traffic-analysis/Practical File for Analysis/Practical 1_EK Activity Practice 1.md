**## Case Overview**



\*\*Source:\*\* MalwareTrafficAnalysis.net



\*\*Exercise Name | Date:\*\* EK Activity Practice Exercise



\*\*PCAP File Name:\*\* "2014-11-08-traffic-analysis-exercise.pcap"



\*\*Traffic Time Range:\*\* 21:30:05 - 21:33:40



\*\*File Link:\*\* <a> https://www.malware-traffic-analysis.net/2014/11/08/index2.html </a>



\*\*Suspected Malware Family (if known):\*\* 



\*\*Analysis Tool(s):\*\* Wireshark



<br>



**## Scenario Summary**

Briefly describe the scenario provided in the exercise.Example: The traffic appears to originate from a Windows host communicating with external IPs, indicating a possible malware infection following a malicious email.



<br>



**## Environment \& Initial Observations**



\*\*Internal IP range:\*\* Multiple Host's detected 172.16.165.132/159



\*\*Suspected victim IP:\*\* 172.165.165.132



\*\*Notable protocols observed:\*\* UDP, HTTP, TCP



\*\*Timezone used for analysis:\*\* UTC



<br>



**## Questions For Analysis**



**### L1- Basic Level Questions**



\*\*Question: Question: What is the IP address of the workstation (the VM) that gets infected?\*\*



**\*\*Answer\*\*** 172.16.165.32



\*\*Search the nbns traffic in the pcap to find the host name of the infected VM.



**\*\*Answer\*\*** WIN-C2KE6N4W3N1 



\*\*Question: What is the MAC address of the infected VM?\*\*\*\*



**\*\*Answer\*\*** 00:0c:29:77:ac:27





\*\*Question: What is the IP address and domain name that delivered the malware?\*\*



**\*\*Answer\*\*** 178.63.209\[.]91 | www\[.]seedradrivergy\[.]co\[.]vu





\*\*Question: What is the IP address and domain name of the compromised web site?\*\*



\*\***Answer**\*\* kentroxarisma\[.]com | 173.254.80\[.]53





<br>



**### Level 2 – Intermediate Level**





\*\*Question: What is the redirect URL that points to the exploit kit landing page?\*\*



\*\*Answer:\*\* genfaglobal\[.]ga | 108.61.177\[.]186





\*\*Question: What type of exploits (Java, Flash, PDF) were sent by the exploit kit?\*\*



\*\*Answer:\*\* PDF 



\*\*Question: What is the MD5 hash of the malware payload?\*\*



\*\*Answer:\*\* pHo28E.pdf | Continue in VM







\*\*Question: What type of callback traffic is generated by the malware?\*\*



\*\*Answer:\*\* 





<br>



**### Level 3 – Advance Level Findings\*\***



\*\*Question\*\*



\*\*Answer\*\*



<br>



**## Wireshark Filters Used**



* http
* DNS
* dns.qry.name or (tcp.flags eq 0x0002 and !(tcp.port eq 80)) \[New Filter used with right understanding]
* http.content\_type == "application/pdf" \&\& "text/html" \&\& "text/css"



<br>



**## Indicators of Compromise (IOCs)**



* **File Name**: pHo28E.pdf 



* **IP-ADDRESS**: 178.63.209\[.]91 



* **RE-Directs:** 108.61.177\[.]186



* **Domain Name**: kentroxarisma\[.]com , genfaglobal\[.]ga



<br>





**## Key Takeaways \& Learning**



**### What I learned from this analysis**

* What I learnt is about EK within itself, what exactly EK is and how dangerous it can be as a malware, the types and forms it can exist in
* Learnt about new filters, learnt about how we have to go detail by detail using the right filter to get the information we need



**### Mistakes or confusion faced**



* First mistake is choosing the Victim. By default when I use the filter of HTTP to find the http traffic, we assume that the first source from where the Machine accessed the HTTP site is itself the victim, rather, I should I have focused on the conversations between the internal client's with the external IP's to actually find the right victim then blind guessing.



* I had a really hard time finding the actual ETK, the right redirect link was something within itself as a challenge for me to do.



* I couldn't find the different any payload mechanism used despite having the solution with



**### New Wireshark techniques used**



* I learnt a new way of understanding the filter which is: dns.qry.name or (tcp.flags eq 0x0002 and !(tcp.port eq 80)).
* This filter helped me understand that we are trying to resolve the query from the host when the host attempts to search for a domain, and when the host begins the tcp connection with the destination domain, while also trying to note that the ports of the destination are not just HTTP, which definitely helps us to get the \*\*suspicious malware traffic\*\*  



**### What I would investigate further in a real SOC**

\-



<br>





**## References**



\- MalwareTrafficAnalysis.net exercise page



\- Any malware research links (if used)



\- Screenshot Link

&nbsp; 















